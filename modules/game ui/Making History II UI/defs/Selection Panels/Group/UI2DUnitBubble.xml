<?xml version="1.0" encoding="UTF-8"?>
<locust xmlns="http://www.muzzylane.com/ml/schema/2009/04/locust">

	<objectDef type="UI2DUnitButton" superType="mlui.UI2DButton">
		<propertyDef name="nOrder" type="int"/>
		<propertyDef name="bEnabled" type="bool" />
	</objectDef>

	<objectDef type="UI2DUnitVital" superType="mlui.UI2DElement" >
		<propertyDef name="tmplImage" type="TemplateRef" restriction="mlmedia.ImageTemplate" />
		<propertyDef name="tmplTextStyle" type="TemplateRef" restriction="mlmedia.TextStyleTemplate" />
		<propertyDef name="strText" type="String" />
		<propertyDef name="nOrder" type="int"/>

		<object type="UI2DCenteredIcon" name="objVitalIcon" >
			<property name="tmplImage" from="def.tmplImage" />
			<property name="nX" value="0" />
			<property name="nY" value="0" />
			<property name="nWidth" from="def.nWidth" />
			<!--<property name="nHeight" from="def.tmplImage.resolve().nImageHeight" />-->
			<property name="nHeight" from="def.nHeight - def.objVitalText.nHeight" />
		</object>

		<object type="mlui.UI2DText" name="objVitalText">
			<property name="tmplTextStyle" from="def.tmplTextStyle"/>
			<property name="strText" from="def.strText"/>
			<property name="nX" value="0"/>
			<property name="nY" from="def.nHeight - self.nHeight"/>
			<property name="nWidth" from="def.nWidth"/>
			<property name="nHeight" from="def.tmplTextStyle.resolve().nFontSize"/>
		</object>

	</objectDef>

	<objectDef type="UI2DUnitBubble" superType="mlui.UI2DElement">
		<propertyDef name="objUnit" type="gs_tbg.Unit"/>
		<propertyDef name="bCanCommand" type="bool">
			self.objUnit.canCommand(mh2data.objAvatar, mh2data.objNation)
		</propertyDef>
    
        <propertyDef name="bSplit" type="bool" default="false"/>	
		<propertyDef name="bToggle" type="bool" default="true"/>
		
		<property name="nWidth" value="328"/>
		<property name="nHeight" value="88"/>

		<propertyDef name="objUnitTemplate" type="gs_tbg.UnitTemplate"/>
		<property name="objUnitTemplate" from="self.objUnit.objUnitTemplate"/>
		
		<propertyDef name="objGroup" type="gs_tbg.UnitGroup">
			self.objUnit.refUnitGroup.resolve(mh2data.objAvatar)
		</propertyDef>
		
		<propertyDef name="objStack" type="mapui.UnitGroupStack">
			mh2data.objMapData.objStacks.getStackForUnitGroup(self.objGroup)
		</propertyDef>

		<object type="mlui.UI2DImage" name="objUnitBG">
			<property name="tmplImage" value="skin.ImgReportBubbleTanWhite"/>
      <!--<property name="tmplImage">
        if (def.bSplit == false,
        "skin.ImgReportBubbleTanWhite",
        "skin.ImgReportBubbleTanBeige"
        )
      </property>-->
			<property name="nX" value="0"/>
			<property name="nY" value="0"/>
			<property name="nWidth" value="328"/>
			<property name="nHeight" value="88"/>
		</object>
		
		<object type="mlui.UI2DButton" name="objPromoteUnit" existsWhile="def.bToggle == true">			
            <property name="tmplButtonStyle" value="skin.BtnStyleHighlight"/>
            <property name="nX" value="0"/>
			<property name="nY" value="0"/>
            <property name="strToolTip" from="def.objUnit.objNationTemplate.tmplDefaultNationality.resolve().strDisplayName + ' ' 
                + def.objUnit.objUnitTemplate.strDisplayName"/>
            <property name="nDepth" value="2"/>
            <property name="nDefaultWidth" from="def.nWidth"/>
            <property name="nDefaultHeight" from="def.nHeight"/>
            <object type="mlevent.EventHandlerMap" name="objEventHandlerMap">
                <object type="mlevent.EvtHdlrMethod" name="objHandlers">
                    <property name="otEventType" value="mlui.EventButtonClicked"/>
                    <script type="application/javascript"><![CDATA[
                        function handle(event, owner)
                        {				
                            mh2data.objMapData.objStacks.setDisplayUnit(def.objStack, def.objGroup, def.objUnit);
                        }
                    ]]></script>
                </object>					
            </object>
		</object>
		
		<!--<object type="mlui.UI2DImage" name="objHealthBarOver">
			--><!--<property name="tmplImage" value="skin.ImgUnitHealthBarOver"/>--><!--
			<property name="nX" value="4"/>
			<property name="nY" value="4"/>
			<property name="nWidth" value="16"/>
			<property name="nHeight" value="56"/>
			<property name="nDepth" value="3"/>
			<property name="strToolTip" from="(def.objUnit.nHitPoints) + '/' +
				(def.objUnit.objUnitTemplate.nHitPoints)"/>
		</object>-->
		
		<propertyDef name="fPercent" type="float">
			float(self.objUnit.nHitPoints) / float(self.objUnit.objUnitTemplate.nHitPoints)
		</propertyDef>


        <object type="mlui.UI2DImage" name="objUnitHealthToolTip">
            <property name="nX" value="196"/>
            <property name="nY" value="36"/>
            <property name="nWidth" from="28"/>
            <property name="nHeight" from="28"/>
            <property name="nDepth" value="3"/>
            <property name="strToolTip" from="((def.objUnit.nHitPoints) * 100) / (def.objUnit.objUnitTemplate.nHitPoints) + locale.SID.UI.Strength"/>
        </object>

        <object type="mlui.UI2DImage" name="objHealth">
            <property name="tmplImage" value="skin.ImgOffWhite"/>
            <property name="colColor" from="#578426FF"/>
            <property name="nX" value="4"/>
            <property name="nY" value="4"/>
            <property name="vaYAlign" value="BOTTOM"/>
            <property name="nWidth" from="(73 * def.fPercent)"/>
            <property name="nHeight" from="5"/>
            <property name="nDepth" value="2"/>
            <property name="strToolTip" from="((def.objUnit.nHitPoints) * 100) / (def.objUnit.objUnitTemplate.nHitPoints) + locale.SID.UI.Strength"/>
        </object>
		
		<object type="mlui.UI2DImage" name="objHealthBG">
			<property name="tmplImage" value="skin.ImgOffWhite"/>
			<property name="colColor" value="#e2d9ceFF"/>
			<property name="nX" value="4"/>
			<property name="nY" value="4"/>
			<property name="vaYAlign" value="BOTTOM"/>
            <property name="nWidth" from="73"/>
            <property name="nHeight" value="5"/>
			<property name="nDepth" value="1"/>
		</object>
		
		<!--<object type="mlui.UI2DImage" name="objHealthBarBG">
			<property name="tmplImage" value="skin.ImgUnitHealthBarBG"/>
			<property name="nX" value="4"/>
			<property name="nY" value="4"/>
			<property name="nHeight" value="16"/>
			<property name="nWidth" value="56"/>
		</object>-->

	<!-- Unit ID -->
		<object type="mlui.UI2DImage" name="objUnitType">
			<property name="tmplImage">
				mh2data.objUnitDisplayTable.getEntry(def.objUnit.objUnitTemplate).tmplImage
			</property>
      <!--  <property name="tmplImage">
                mh2data.objUnitDisplayTable.getEntry(def.objUnit.objUnitTemplate).tmplIcon
            </property>-->
			<property name="nX" value="2"/>
			<property name="nY" value="2"/>
			<property name="nWidth" value="77"/>
			<property name="nHeight" value="77"/>
		</object>
		
		<object type="LookupNationIcons" name="objLookupNationIcons">
			<property name="tmplNation" from="def.objUnit.objNationTemplate"/>
			<property name="tmplIdeology" from="def.objUnit.objNationTemplate.tmplIdeology"/>
		</object>		
		
		<object type="mlui.UI2DImage" name="objIcon">
			<property name="tmplImage" from="def.objLookupNationIcons.tmplIcon28x28"/>
			<property name="nX" value="80"/>
			<property name="nY" value="3"/>
			<property name="nWidth" value="28"/>
			<property name="nHeight" value="28"/>
			<property name="strToolTip" from="locale.SID.UI.UnitNationality + ': ' +
				def.objUnit.objNationTemplate.tmplDefaultNationality.resolve().strDisplayName"/>
		</object>
		
		<object type="mlui.UI2DText" name="objName" existsWhile="def.bChangeName == false">
			<property name="tmplTextStyle" value="locale.TxtStyleArialDarkerBrown13LeftFit"/>
			<property name="strText" from="def.objUnit.strDisplayName"/>
			<property name="nX" value="110"/>
			<property name="nY" value="6"/>
			<property name="nHeight" value="16"/>
			<property name="eMouseBehavior" value="MOUSE_BHVR_IGNORE_THIS_ELEMENT"/>
		</object>
		
		<propertyDef name="bChangeName" type="bool" default="false"/>

		<object type="mlui.UI2DEditableText" name="objEditableText" existsWhile="def.bChangeName == true">
			<property name="tmplTextStyle" value="locale.TxtStyleArialDarkerBrown13LeftFitForEditing"/>
			<property name="nX" value="110"/>
			<property name="nY" value="6"/>
			<property name="nWidth" value="200"/>
			<property name="nHeight" from="16"/>
			<property name="nDepth" value="3"/>
			<property name="eIgnoreKeys" value="KEY_CODE_ESCAPE"/>
			<property name="eIgnoreKeys" value="KEY_CODE_RETURN"/>
			<property name="eIgnoreKeys" value="KEY_CODE_GRAVE"/>
			<property name="eIgnoreKeys" value="KEY_CODE_TAB"/>

			<object type="mlui.KeyBindList" name="objKeyBindList">
				<object type="mlui.KeyBindMethod" name="objKeyBinds">
					<property name="otEventType" value="mlui.EventKeyPressed"/>
					<property name="eKey" value="KEY_CODE_RETURN"/>
					<script type="application/javascript"><![CDATA[
						function notifyTriggered(owner) {
							if(def.objEditableText.strText != '')
							{
								var action = gs_tbg.GActRenameUnit.create({
									"strNewName": def.objEditableText.strText,
									"refUnit": def.objUnit
								});
							mh2data.objAvatar.sendAction(action);
							def.objEditableText.strText = '';
							def.bChangeName = false;
							}
							else
							{
								mlui.ActClearKeyboardFocus.execute({"objElement": def.objEditableText});
								def.bChangeName = false;
							}
						}
					]]></script>
				</object>
			</object>
		</object>

		<object type="mlui.UI2DText" name="objUnitTemplateName">
			<property name="tmplTextStyle" value="locale.TxtStyleArialDarkBrown10Left"/>
			<property name="strText" from="def.objUnit.objUnitTemplate.strDisplayName"/>
			<property name="nX" value="110"/>
			<property name="nY" value="20"/>
			<property name="nWidth" value="140"/>
			<property name="nHeight" value="10"/>
		</object>

		<!--<object type="mlui.UI2DImage" name="objReinforceIcon" existsWhile="def.objUnit.bRepairing" >-->
		<!--	<property name="tmplImage" value="skin.ImgInfoIconReinforce"/>-->
		<!--	<property name="nX" value="55"/>-->
		<!--	<property name="nY" value="31"/>-->
		<!--	<property name="nWidth" value="29"/>-->
		<!--	<property name="nHeight" value="16"/>-->
		<!--</object>-->

	<!-- Unit Buttons -->

		<propertyDef name="objTrack" type="Object">
			self.objUnit.getTopValidUpgradeTrack(mh2data.objAvatar)
		</propertyDef>

        <propertyDef name="bCanAffordUpgrade" type="bool">
            if(self.bCanCommand,
            self.objTrack.bCanAfford(mh2data.objAvatar, mh2data.objNation)
            ,
            false
            )
        </propertyDef>
        
        <propertyDef name="bCanUpgrade" type="bool">
            if(self.bCanCommand,
            self.objUnit.refUnitGroup.resolve(mh2data.objAvatar).bInSupply
            ,
            false
            )
        </propertyDef>

    <object type="UI2DUnitButton" name="objElements" existsWhile="def.bSplit">
      <property name="nX" value="304"/>
      <property name="nY" value="3"/>
      <property name="tmplButtonStyle">
        if(def.objChosenObjectData == null OR def.objChosenObjectData.bChosen,
        'skin.BtnStyleRegionProjectsQueueCancel', 'skin.BtnStyleRegionProjectsAddToQueue')
      </property>
      <property name="nDefaultWidth" value="21"/>
      <property name="nDefaultHeight" value="21"/>
      <property name="strToolTip" from="locale.SID.UI.SelectUnit"/>
    </object>
    
     <object type="common_ui.UI2DListHorz" name="objGroupInfo" existsWhile="!def.bSplit">
			<property name="nX" value="3"/>
			<property name="nY" value="3"/>
			<property name="haXAlign" value="RIGHT"/>
			<property name="nSpacing" value="1"/>
			<property name="nDepth" value="3"/>
			
      <object type="UI2DUnitUpgradeButton" name="objElements">
          <property name="objUnit" from="def.objUnit"/>
          <property name="objTrack" >
              def.objUnit.getTopValidUpgradeTrack(mh2data.objAvatar)                
          </property>
          <property name="nWidth" value="21"/>
          <property name="nHeight" value="21"/>
      </object>
		
			<object type="UI2DUnitButton" name="objElements">
				<property name="tmplButtonStyle" value="skin.BtnStyleUnitButtonRename"/>
				<property name="bEnabled" from="def.bCanCommand" />
				<property name="nDefaultWidth" value="21"/>
				<property name="nDefaultHeight" value="21"/>
				<property name="bVisible" from="def.bCanCommand"/>
				<property name="strToolTip" from="locale.SID.UI.RenameUnit"/>
	
				<object type="mlevent.EventHandlerMap" name="objEventHandlerMap">
					<object type="mlevent.EvtHdlrMethod" name="objHandlers">
						<property name="otEventType" value="mlui.EventButtonClicked"/>
						<script type="application/javascript"><![CDATA[
							function handle(event, owner)
							{
								if (def.bChangeName == true)
									{
										if(def.objEditableText.strText == '')
										{
										
										}
										else
										{
											var action = gs_tbg.GActRenameUnit.create({
												"strNewName": def.objEditableText.strText,
												"refUnit": def.objUnit
											});
											mh2data.objAvatar.sendAction(action);
											def.objEditableText.strText = '';
										}
									//mlui.ActClearKeyboardFocus.execute({"objElement": def.objEditableText});
									def.bChangeName = false;
									}
								else
									{
									def.bChangeName = true;
									def.objEditableText.strText = '';
									mlui.ActSetKeyboardFocus.execute({"objElement": def.objEditableText});
									}
							}
						]]></script>
					</object>
				</object>
			</object>
		
			<object type="UI2DUnitInfoButton" name="objElements">
				<property name="objTmpl" from="def.objUnit.objUnitTemplate"/>
				<property name="tmplButtonStyle" from="skin.getTemplateRef(mlmedia.ButtonStyleTemplate, 'BtnStyleUnitButtonOpen')"/>
				<property name="nDefaultWidth" value="21"/>
				<property name="nDefaultHeight" value="21"/>
        <property name="strToolTip" from="locale.SID.UI.Encyclopediaentryfor + '&#010;' + def.objUnit.objUnitTemplate.strDisplayName"/>
			</object>
		</object>
		
		<object type="UI2DUnitVitals" name="objUnitTemplateStats">
			<property name="objUnit" from="def.objUnit"/>
			<property name="nX" value="81"/>
			<property name="nY" value="35"/>
      <property name="nWidth" from="def.nWidth" />
			<property name="nHeight" from="50" />
            <property name="nDepth" value="2"/>
			<property name="eMouseBehavior" value="MOUSE_BHVR_IGNORE_THIS_ELEMENT"/>
		</object>
	</objectDef>
	
	<objectDef type="UI2DUnitUpgradeCost" superType="mlui.UI2DToolTipDefault">
		<property name="nWidth" from="self.objStats.nWidth + self.nHorizPadding"/>
		<property name="nHeight" from="self.objStats.nHeight + self.nVertPadding"/>
		<property name="nOffsetX" value="32"/>
		<property name="nOffsetY" value="32"/>

		<propertyDef name="strRequirements" type="String" variable="true">
			map(
				?{resource:
					resource.tmplResource.resolve().strDisplayName + ': ' + resource.nAmount
				},
				self.objElement.parent.objTrack.objResourceRequirements
			)
		</propertyDef>

		<object type="mlui.UI2DImage" name="objBorder">
			<property name="tmplImage" value="default_media.ImgToolTipBorder"/>
			<property name="nWidth" from="def.nWidth"/>
			<property name="nHeight" from="def.nHeight"/>
			<property name="nDepth" value="0"/>
		</object>
		<object type="mlui.UI2DImage" name="objBackground">
			<property name="tmplImage" value="default_media.ImgToolTipBackground"/>
			<property name="nX" value="1"/>
			<property name="nY" value="1"/>
			<property name="nWidth"  from="def.nWidth - 2"/>
			<property name="nHeight" from="def.nHeight - 2"/>
			<property name="nDepth" value="1"/>
		</object>
		
		<object type="common_ui.UI2DList" name="objStats">
			<property name="nX" value="3"/>
			<property name="nDepth" value="10"/>
			<object type="mlui.UI2DText" name="objElements">
				<property name="tmplTextStyle" value="default_media.TxtStyleToolTip"/>
				<property name="strText">
					locale.SID.UI.UpgradeUnit + ' ' + def.objElement.parent.objTrack.tmplUpgradeUnit.resolve().strDisplayName
				</property>
				<property name="haXAlign" value="CENTER"/>
				<property name="nY" value="0"/>
				<property name="nWidth" value="256"/>
				<property name="nHeight" value="16"/>
				<property name="nDepth" value="2"/>
			</object>
			<object type="mlui.UI2DText" name="objElements">
				<property name="tmplTextStyle" value="default_media.TxtStyleToolTip"/>
				<property name="strText" from="locale.SID.UI.MPUs + ': ' + def.objElement.parent.objTrack.nMPUs"/>
				<property name="haXAlign" value="CENTER"/>
				<property name="nY" value="0"/>
				<property name="nWidth" value="256"/>
				<property name="nHeight" value="16"/>
				<property name="nDepth" value="2"/>
                <property name="bVisible" from="def.objElement.parent.objTrack.nMPUs != 0"/>
              </object>
			<object type="mlui.UI2DText" name="objElements" tiedTo="def.strRequirements">
				<property name="tmplTextStyle" value="default_media.TxtStyleToolTip"/>
				<property name="strText" from="tiedTo"/>
				<property name="haXAlign" value="CENTER"/>
				<property name="nY" value="0"/>
				<property name="nWidth" value="256"/>
				<property name="nHeight" value="16"/>
				<property name="nDepth" value="2"/>
			</object>
			
		</object>
		
		
		
	</objectDef>
    
	<objectDef type="UI2DUnitUpgradeCostUnavailable" superType="mlui.UI2DToolTipDefault">
		<property name="nWidth" from="self.objStats.nWidth + self.nHorizPadding"/>
		<property name="nHeight" from="self.objStats.nHeight + self.nVertPadding"/>
		<property name="nOffsetX" value="32"/>
		<property name="nOffsetY" value="32"/>

		<propertyDef name="strRequirements" type="String" variable="true">
			map(
				?{resource:
					resource.tmplResource.resolve().strDisplayName + ': ' + resource.nAmount
				},
				self.objElement.parent.objTrack.objResourceRequirements
			)
		</propertyDef>

		<object type="mlui.UI2DImage" name="objBorder">
			<property name="tmplImage" value="default_media.ImgToolTipBorder"/>
			<property name="nWidth" from="def.nWidth"/>
			<property name="nHeight" from="def.nHeight"/>
			<property name="nDepth" value="0"/>
		</object>
		<object type="mlui.UI2DImage" name="objBackground">
			<property name="tmplImage" value="default_media.ImgToolTipBackground"/>
			<property name="nX" value="1"/>
			<property name="nY" value="1"/>
			<property name="nWidth"  from="def.nWidth - 2"/>
			<property name="nHeight" from="def.nHeight - 2"/>
			<property name="nDepth" value="1"/>
		</object>
		
		<object type="common_ui.UI2DList" name="objStats">
			<property name="nX" value="3"/>
			<property name="nDepth" value="10"/>
			<object type="mlui.UI2DText" name="objElements">
				<property name="tmplTextStyle" value="default_media.TxtStyleToolTip"/>
				<property name="strText">
					locale.SID.UI.UnableToUpgradeUnit + ' ' + def.objElement.parent.objTrack.tmplUpgradeUnit.resolve().strDisplayName
				</property>
				<property name="haXAlign" value="CENTER"/>
				<property name="nY" value="0"/>
				<property name="nWidth" value="256"/>
				<property name="nHeight" value="16"/>
				<property name="nDepth" value="2"/>
			</object>
			
			<object type="mlui.UI2DText" name="objElements">
				<property name="tmplTextStyle" value="default_media.TxtStyleToolTip"/>
				<property name="strText" from="locale.SID.UI.MPUs + ': ' + def.objElement.parent.objTrack.nMPUs"/>
				<property name="haXAlign" value="CENTER"/>
				<property name="nY" value="0"/>
				<property name="nWidth" value="256"/>
				<property name="nHeight" value="16"/>
				<property name="nDepth" value="2"/>
                <property name="bVisible" from="def.objElement.parent.objTrack.nMPUs != 0"/>
              </object>
			
			<object type="mlui.UI2DText" name="objElements" tiedTo="def.strRequirements">
				<property name="tmplTextStyle" value="default_media.TxtStyleToolTip"/>
				<property name="strText" from="tiedTo"/>
				<property name="haXAlign" value="CENTER"/>
				<property name="nY" value="0"/>
				<property name="nWidth" value="256"/>
				<property name="nHeight" value="16"/>
				<property name="nDepth" value="2"/>
			</object>
			
		</object>
	</objectDef>
	
	<objectDef type="UI2DUnitBubbleToggle" superType="UI2DUnitBubble">
		<propertyDef name="objChosenObjectData" type="ChosenObjectData"/>

		<object type="mlui.ButtonState" name="objState">
		</object>

    <property name="bSplit" value="true"/>
		<object type="mlui.UI2DImage" name="objUnitBG">
			<property name="tmplImage">
				if(def.objChosenObjectData.bChosen,
					skin.getTemplateRef(mlmedia.ImageTemplate, 'ImgReportBubbleTanBeige'),
					skin.getTemplateRef(mlmedia.ImageTemplate, 'ImgReportBubbleTanWhite')
				)
			</property>
			<property name="nX" value="0"/>
			<property name="nY" value="0"/>
			<property name="nWidth" value="328"/>
			<property name="nHeight" value="88"/>

      <property name="strToolTip" from="locale.SID.UI.SelectUnitsToSplit"/>
    </object>

		<!-- Click Mask -->

		<object type="mlevent.EventHandlerMap" name="objEventHandlerMap">

			<object type="mlui.EvtHdlrButtonSingleClick" name="objHandlers">
				<property name="objState" from="def.objState"/>
			</object>

			<object type="mlevent.EvtHdlrMethod" name="objHandlers">
				<property name="otEventType" value="mlui.EventButtonClicked"/>
				<script type="application/javascript"><![CDATA[
					function handle(event, owner)
					{
						def.objChosenObjectData.toggleChosen();
					}
				]]></script>
			</object>

		</object>

	</objectDef>

	<objectDef type="UI2DUnitButtonRow" superType="mlui.UI2DElement">
		<propertyDef name="objUnit" type="gs_tbg.Unit"/>
		<propertyDef name="bCanCommand" type="bool"/>
		<propertyDef name="bChangeName" type="bool"/>
		<propertyDef name="objTrack" type="Object">
			self.objUnit.getTopValidUpgradeTrack(mh2data.objAvatar)
		</propertyDef>

		<propertyDef name="objButtons" type="mlui.UI2DElement" variable="true" storesChildren="true"/>
		<object type="mlui.UILMFlow" name="objFlow">
			<property name="listElements">
					sortAscending(?{button: button.nOrder}, def.objButtons)
			</property>
			<property name="orientAtion" value="HORIZONTAL" />
			<property name="nTopSpacing" value="0"/>
			<property name="nBottomSpacing" value="0"/>
			<property name="nSpacing" value="0"/>
		</object>

		<object type="UI2DUnitButton" name="objButtons" existsWhile="def.objTrack != null AND def.objUnit.tmplUpgradeUnit == null">
			<property name="tmplButtonStyle" from="skin.getTemplateRef(mlmedia.ButtonStyleTemplate,
					if(self.bEnabled,
					'BtnStyleUnitButtonUpgrade', 'BtnStyleUnitButtonUpgradeDisabled'))
			"/>
			<property name="bEnabled" from="def.bCanCommand" />
			<property name="nOrder" value="1" />
			<property name="nDefaultWidth" value="21"/>
			<property name="nDefaultHeight" value="21"/>

			<object type="mlevent.EventHandlerMap" name="objEventHandlerMap">
				<object type="mlevent.EvtHdlrMethod" name="objHandlers">
					<property name="otEventType" value="mlui.EventButtonClicked"/>
					<script type="application/javascript"><![CDATA[
						function handle(event, owner)
						{
							var action = gs_tbg.GActSetUnitUpgrade.create({
								"refUnit": def.objUnit,
								"objUnitTemplate": def.objTrack.tmplUpgradeUnit
							});
							mh2data.objAvatar.sendAction(action);
						}
					]]></script>
				</object>
			</object>
		</object>
		
		<object type="UI2DUnitButton" name="objButtons" existsWhile="def.objUnit.tmplUpgradeUnit != null">
			<property name="tmplButtonStyle" value="skin.BtnStyleUnitButtonCancel"/>
			<property name="bEnabled" from="def.bCanCommand" />
			<property name="nOrder" value="1" />
			<property name="nDefaultWidth" value="21"/>
			<property name="nDefaultHeight" value="21"/>

			<object type="mlevent.EventHandlerMap" name="objEventHandlerMap">
				<object type="mlevent.EvtHdlrMethod" name="objHandlers">
					<property name="otEventType" value="mlui.EventButtonClicked"/>
					<script type="application/javascript"><![CDATA[
						function handle(event, owner)
						{
							var action = gs_tbg.GActCancelUnitUpgrade.create({
								"refUnit": def.objUnit
							});
							mh2data.objAvatar.sendAction(action);
						}
					]]></script>
				</object>
			</object>
		</object>
		
		<object type="UI2DUnitButton" name="objButtons">
			<property name="tmplButtonStyle" value="skin.BtnStyleUnitButtonRename"/>
			<property name="bEnabled" from="def.bCanCommand" />
			<property name="nOrder" value="1" />
			<property name="nDefaultWidth" value="21"/>
			<property name="nDefaultHeight" value="21"/>

			<object type="mlevent.EventHandlerMap" name="objEventHandlerMap">
				<object type="mlevent.EvtHdlrMethod" name="objHandlers">
					<property name="otEventType" value="mlui.EventButtonClicked"/>
					<script type="application/javascript"><![CDATA[
						function handle(event, owner)
						{
							log("Rename button");
						}
					]]></script>
				</object>
			</object>
		</object>

    <object type="UI2DUnitInfoButton" name="objButtons">
      <property name="nOrder" value="2"/>
      <property name="objTmpl" from="def.objUnit.objUnitTemplate"/>
      <property name="tmplButtonStyle" from="skin.getTemplateRef(mlmedia.ButtonStyleTemplate, 'BtnStyleUnitButtonOpen')"/>
      <property name="nDefaultWidth" value="21"/>
      <property name="nDefaultHeight" value="21"/>
      <property name="strToolTip" from="locale.SID.UI.Encyclopediaentryfor + '&#010;' + def.objUnit.objUnitTemplate.strDisplayName"/>
    </object>
	</objectDef>
	
	<objectDef type="UI2DUnitInfoButton" superType="UI2DInfoButton">
		<propertyDef name="nOrder" type="int"/>
	</objectDef>
	
	<objectDef type="UI2DUnitStat" superType="mlui.UI2DElement">
		<propertyDef name="nValue" type="int" default="1"/>
		<propertyDef name="tmplImage" type="TemplateRef" restriction="mlmedia.ImageTemplate"/>
    
		<!--<property name="nWidth" from="self.objStatValue.nWidth + 29"/>-->
    <property name="nWidth" from="25"/>

			
			<object type="mlui.UI2DImage" name="objPropertyIcon" >
				<property name="tmplImage" from="def.tmplImage"/>
				<property name="nX" value="0"/>
				<property name="nY" value="0"/>
        <property name="vaYAlign" value="TOP"/>
        <property name="haXAlign" value="CENTER"/>
				<property name="nWidth" value="25"/>
				<property name="nHeight" value="26"/>
			</object>
			
			<object type="mlui.UI2DText" name="objStatValue">
				<property name="tmplTextStyle" value="locale.TxtStyleArialBlue13Center"/>
				<property name="strText" from="def.nValue"/>
				<property name="nX" value="0"/>
        <property name="nY" value="15"/>
				<property name="vaYAlign" value="MIDDLE"/>
        <property name="haXAlign" value="CENTER"/>
        <property name="nWidth" value="38"/>
				<property name="nHeight" value="26"/>
			</object>
    
	</objectDef>

  <objectDef type="UI2DUnitHealth" superType="mlui.UI2DElement">
    <propertyDef name="nValue" type="int" default="1"/>
    <propertyDef name="nValue2" type="int" default="1"/>
    <propertyDef name="tmplImage" type="TemplateRef" restriction="mlmedia.ImageTemplate"/>
    <property name="nWidth" from="32"/>

    <object type="mlui.UI2DImage" name="objHealthIcon" >
      <property name="tmplImage" from="def.tmplImage"/>
      <property name="nX" value="0"/>
      <property name="nY" value="0"/>
      <property name="haXAlign" value="CENTER"/>
      <property name="nWidth" value="25"/>
      <property name="nHeight" value="26"/>
    </object>

    <object type="mlui.UI2DText" name="objRemaningHitPoints">
      <property name="tmplTextStyle" value="locale.TxtStyleArialBlue13Right"/>
      <property name="strText" from="def.nValue + '/'"/>
      <property name="nX" value="15"/>
      <property name="nY" value="15"/>
      <property name="vaYAlign" value="MIDDLE"/>
      <property name="haXAlign" value="RIGHT"/>
      <property name="nWidth" value="32"/>
      <property name="nHeight" value="26"/>
    </object>

    <object type="mlui.UI2DText" name="objHitPoints">
      <property name="tmplTextStyle" value="locale.TxtStyleArialBlue13Left"/>
      <property name="strText" from="def.nValue2 + ' '"/>
      <property name="nX" value="17"/>
      <property name="nY" value="15"/>
      <property name="vaYAlign" value="MIDDLE"/>
      <property name="haXAlign" value="LEFT"/>
      <property name="nWidth" value="32"/>
      <property name="nHeight" value="26"/>
    </object>

  </objectDef>

  <objectDef type="UI2DUnitSpeed" superType="mlui.UI2DElement">
    <propertyDef name="nValue" type="int" default="1"/>
    <propertyDef name="tmplImage" type="TemplateRef" restriction="mlmedia.ImageTemplate"/>
    <property name="nWidth" from="38"/>

    <object type="mlui.UI2DImage" name="objSpeedIcon" >
      <property name="tmplImage" from="def.tmplImage"/>
      <property name="nX" value="0"/>
      <property name="nY" value="0"/>
      <property name="haXAlign" value="CENTER"/>
      <property name="nWidth" value="38"/>
      <property name="nHeight" value="26"/>
    </object>

    <object type="mlui.UI2DText" name="objSpeedValue">
      <property name="tmplTextStyle" value="locale.TxtStyleArialBlue13Center"/>
      <property name="strText" from="def.nValue"/>
      <property name="nX" value="0"/>
      <property name="nY" value="15"/>
      <property name="vaYAlign" value="MIDDLE"/>
      <property name="haXAlign" value="CENTER"/>
      <property name="nWidth" value="38"/>
      <property name="nHeight" value="26"/>
    </object>

  </objectDef>
  
	<objectDef type="UI2DUnitVitals" superType="mlui.UI2DElement" >
		<!-- Input -->
		<propertyDef name="objUnit" type="gs_tbg.Unit" />
		
		<!-- internals -->
		<propertyDef name="bArmyUnit" type="bool" >
            self.objUnit.objUnitTemplate.tmplUnitSubBranch.resolve().tmplUnitBranch == sd.getTemplateRef(gs_tbg.UnitBranchTemplate, 'Army')
        </propertyDef>
		<propertyDef name="bAirForceUnit" type="bool" >
            self.objUnit.objUnitTemplate.tmplUnitSubBranch.resolve().tmplUnitBranch == sd.getTemplateRef(gs_tbg.UnitBranchTemplate, 'AirForce')
        </propertyDef>
		<propertyDef name="bNavalUnit" type="bool" >
            self.objUnit.objUnitTemplate.tmplUnitSubBranch.resolve().tmplUnitBranch == sd.getTemplateRef(gs_tbg.UnitBranchTemplate, 'Navy') OR
            self.objUnit.objUnitTemplate.tmplUnitSubBranch.resolve().tmplUnitBranch == sd.getTemplateRef(gs_tbg.UnitBranchTemplate, 'Submarine')
        </propertyDef>
		
		<propertyDef name="tmplUnitLevel" type="gs_tbg.UnitExperienceTemplate">
			self.objUnit.getUnitLevel(mh2data.objAvatar)
		</propertyDef>
		
		<object type="common_ui.UI2DListHorz" name="objUnitStatsList" existsWhile="def.bArmyUnit" >
			<property name="nSpacing" value="12"/>
			
			<object type="UI2DUnitStat" name="objElements">
				<property name="nY" value="0"/>
				<property name="nX" value="0"/>
				<property name="nHeight" value="26"/>
				<property name="nValue" from="(def.objUnit.objUnitTemplate.nLandAttackHitPercent * def.objUnit.objUnitTemplate.nAttackDamage) / 10"/>
				<property name="tmplImage" value="skin.ImgInfoIconOffenseTny"/>
				<property name="strToolTip" from="
					locale.SID.UI.AttackVsLand + '&#010;  ' + 
					locale.SID.UI.ChanceToHit + ': ' +  def.objUnit.objUnitTemplate.nLandAttackHitPercent + '%'  + '&#010;  ' +
					locale.SID.UI.BaseDamage + ': ' +  def.objUnit.objUnitTemplate.nAttackDamage"/>
			</object>
			
			<object type="UI2DUnitStat" name="objElements">
				<property name="nY" value="0"/>
				<property name="nX" value="0"/>
				<property name="nHeight" value="26"/>
				<property name="nValue" from="(def.objUnit.objUnitTemplate.nLandDefenseHitPercent * def.objUnit.objUnitTemplate.nAttackDamage) / 10"/>
				<property name="tmplImage" value="skin.ImgInfoIconDefenseTny"/>
				<property name="strToolTip" from="
					locale.SID.UI.AttackVsInvasion + '&#010;  ' + 
					locale.SID.UI.ChanceToHit + ': ' +  def.objUnit.objUnitTemplate.nLandDefenseHitPercent + '%'  + '&#010;  ' +
					locale.SID.UI.BaseDamage + ': ' +  def.objUnit.objUnitTemplate.nAttackDamage"/>
			</object>
			
			<object type="UI2DUnitStat" name="objElements">
				<property name="nY" value="0"/>
				<property name="nX" value="0"/>
				<property name="nHeight" value="26"/>
				<property name="nValue" from="(def.objUnit.objUnitTemplate.nAirHitPercent * def.objUnit.objUnitTemplate.nAttackDamage) / 10"/>
				<property name="tmplImage" value="skin.ImgInfoIconAirAttackTny"/>
				<property name="strToolTip" from="
					locale.SID.UI.AttackVsAir + '&#010;  ' + 
					locale.SID.UI.ChanceToHit + ': ' +  def.objUnit.objUnitTemplate.nAirHitPercent + '%'  + '&#010;  ' +
					locale.SID.UI.BaseDamage + ': ' +  def.objUnit.objUnitTemplate.nAttackDamage"/>
			</object>

      <object type="UI2DUnitHealth" name="objElements">
        <property name="nY" value="0"/>
        <property name="nX" value="0"/>
        <property name="nHeight" value="26"/>
        <property name="nValue" from="(def.objUnit.nHitPoints)"/>
        <property name="nValue2" from="(def.objUnit.objUnitTemplate.nHitPoints)"/>
        <property name="tmplImage" value="skin.ImgInfoIconHealthTny"/>
        <!--<property name="strToolTip" from="locale.SID.UI.HitPoints"/>-->
      </object>

      <object type="UI2DUnitStat" name="objElements">
				<property name="nY" value="0"/>
				<property name="nX" value="0"/>
				<property name="nHeight" value="26"/>
				<property name="nValue" from="def.objUnit.nExperience"/>
				<property name="tmplImage" value="skin.ImgInfoIconExperienceTny"/>
				<property name="strToolTip" from="
					locale.SID.UI.ExperienceLevel + ': ' +
						def.tmplUnitLevel.strDisplayName +
							'&#010;  ' +
					locale.SID.UI.CombatModifier + ': ' +
						find(
							?{mod: mod.eCombatProperty == gs_tbg.CombatProperty.COMBAT_PROPERTY_LAND_ATTACK},
								def.tmplUnitLevel.objCombatModifiers).nModifierValue + '%' +
									'&#010;  ' +
					locale.SID.UI.DamageModifier + ': ' +
						find(
							?{mod: mod.eCombatProperty == gs_tbg.CombatProperty.COMBAT_PROPERTY_ATTACK_DAMAGE},
								def.tmplUnitLevel.objCombatModifiers).nModifierValue"/>
			</object>

      <object type="UI2DUnitSpeed" name="objElements">
        <property name="nY" value="0"/>
        <property name="nX" value="0"/>
        <property name="nHeight" value="26"/>
        <property name="nValue">
            def.objUnit.objUnitTemplate.nSpeed
        </property>
        <property name="tmplImage" value="skin.ImgUnitIconSpeedTny"/>
        <property name="strToolTip" from="locale.SID.UI.UnitMovementRange"/>
      </object>
      

		</object>
	
		<object type="common_ui.UI2DListHorz" name="objUnitStatsList" existsWhile="def.bAirForceUnit" >
			<property name="nSpacing" value="12"/>
			
			<object type="UI2DUnitStat" name="objElements">
				<property name="nY" value="0"/>
				<property name="nX" value="0"/>
				<property name="nHeight" value="26"/>
				<property name="nValue" from="(def.objUnit.objUnitTemplate.nAirHitPercent * def.objUnit.objUnitTemplate.nAttackDamage) / 10"/>
				<property name="tmplImage" value="skin.ImgInfoIconAirAttackTny"/>
				<property name="strToolTip" from="
					locale.SID.UI.AttackVsAir + '&#010;  ' + 
					locale.SID.UI.ChanceToHit + ': ' +  def.objUnit.objUnitTemplate.nAirHitPercent + '%'  + '&#010;  ' +
					locale.SID.UI.BaseDamage + ': ' +  def.objUnit.objUnitTemplate.nAttackDamage"/>
			</object>
			
			<object type="UI2DUnitStat" name="objElements">
				<property name="nY" value="0"/>
				<property name="nX" value="0"/>
				<property name="nHeight" value="26"/>
				<property name="nValue" from="(def.objUnit.objUnitTemplate.nLandAttackHitPercent * def.objUnit.objUnitTemplate.nAttackDamage) / 10"/>
				<property name="tmplImage" value="skin.ImgUnitIconAirGroundAttackTny"/>
				<property name="strToolTip" from="
					locale.SID.UI.AttackVsLand + '&#010;  ' + 
					locale.SID.UI.ChanceToHit + ': ' +  def.objUnit.objUnitTemplate.nLandAttackHitPercent + '%'  + '&#010;  ' +
					locale.SID.UI.BaseDamage + ': ' +  def.objUnit.objUnitTemplate.nAttackDamage"/>
			</object>
			
			<object type="UI2DUnitStat" name="objElements">
				<property name="nY" value="0"/>
				<property name="nX" value="0"/>
				<property name="nHeight" value="26"/>
				<property name="nValue" from="(def.objUnit.objUnitTemplate.nSeaSurfaceHitPercent * def.objUnit.objUnitTemplate.nAttackDamage) / 10"/>
				<property name="tmplImage" value="skin.ImgUnitIconNavalAttackTny"/>
				<property name="strToolTip" from="
					locale.SID.UI.AttackVsNavy + '&#010;  ' + 
					locale.SID.UI.ChanceToHit + ': ' +  def.objUnit.objUnitTemplate.nSeaSurfaceHitPercent + '%'  + '&#010;  ' +
					locale.SID.UI.BaseDamage + ': ' +  def.objUnit.objUnitTemplate.nAttackDamage"/>
			</object>

      <object type="UI2DUnitHealth" name="objElements">
        <property name="nY" value="0"/>
        <property name="nX" value="0"/>
        <property name="nHeight" value="26"/>
        <property name="nValue" from="(def.objUnit.nHitPoints)"/>
        <property name="nValue2" from="(def.objUnit.objUnitTemplate.nHitPoints)"/>
        <property name="tmplImage" value="skin.ImgInfoIconHealthTny"/>
        <!--<property name="strToolTip" from="locale.SID.UI.HitPoints"/>-->
      </object>

      <object type="UI2DUnitStat" name="objElements">
				<property name="nY" value="0"/>
				<property name="nX" value="0"/>
				<property name="nHeight" value="26"/>
				<property name="nValue" from="def.objUnit.nExperience"/>
				<property name="tmplImage" value="skin.ImgInfoIconExperienceTny"/>
				<property name="strToolTip" from="
					locale.SID.UI.ExperienceLevel + ': ' + def.tmplUnitLevel.strDisplayName + '&#010;  ' +
					locale.SID.UI.CombatModifier + ': ' + find(?{mod: mod.eCombatProperty == gs_tbg.CombatProperty.COMBAT_PROPERTY_AIR},
						def.tmplUnitLevel.objCombatModifiers).nModifierValue + '%' + '&#010;  ' +
					locale.SID.UI.DamageModifier + ': ' + find(?{mod: mod.eCombatProperty == gs_tbg.CombatProperty.COMBAT_PROPERTY_ATTACK_DAMAGE},
						def.tmplUnitLevel.objCombatModifiers).nModifierValue"/>
			</object>

      <object type="UI2DUnitStat" name="objElements">
        <property name="nY" value="0"/>
        <property name="nX" value="0"/>
        <property name="nHeight" value="26"/>
        <property name="nWidth" value="36"/>
        <property name="nValue">
          def.objUnit.objUnitTemplate.nMissionRange
        </property>
        <property name="tmplImage" value="skin.ImgUnitIconRangeTny"/>
        <property name="strToolTip" from="locale.SID.UI.UnitFlightRange"/>
      </object>
    </object>		
	
		<object type="common_ui.UI2DListHorz" name="objUnitStatsList" existsWhile="def.bNavalUnit" >
			<property name="nSpacing" value="12"/>
			
			<object type="UI2DUnitStat" name="objElements">
				<property name="nY" value="0"/>
				<property name="nX" value="0"/>
				<property name="nHeight" value="26"/>
				<property name="nValue" from="(def.objUnit.objUnitTemplate.nSeaSurfaceHitPercent * def.objUnit.objUnitTemplate.nAttackDamage) / 10"/>
				<property name="tmplImage" value="skin.ImgUnitIconNavalAttackTny"/>
				<property name="strToolTip" from="
					locale.SID.UI.AttackVsNavy + '&#010;  ' + 
					locale.SID.UI.ChanceToHit + ': ' +  def.objUnit.objUnitTemplate.nSeaSurfaceHitPercent + '%'  + '&#010;  ' +
					locale.SID.UI.BaseDamage + ': ' +  def.objUnit.objUnitTemplate.nAttackDamage"/>
			</object>
			
			<object type="UI2DUnitStat" name="objElements">
				<property name="nY" value="0"/>
				<property name="nX" value="0"/>
				<property name="nHeight" value="26"/>
				<property name="nValue" from="(def.objUnit.objUnitTemplate.nAirHitPercent * def.objUnit.objUnitTemplate.nAttackDamage) / 10"/>
				<property name="tmplImage" value="skin.ImgInfoIconAirAttackTny"/>
				<property name="strToolTip" from="
					locale.SID.UI.AttackVsAir + '&#010;  ' + 
					locale.SID.UI.ChanceToHit + ': ' +  def.objUnit.objUnitTemplate.nAirHitPercent + '%'  + '&#010;  ' +
					locale.SID.UI.BaseDamage + ': ' +  def.objUnit.objUnitTemplate.nAttackDamage"/>
			</object>

      <object type="UI2DUnitHealth" name="objElements">
        <property name="nY" value="0"/>
        <property name="nX" value="0"/>
        <property name="nHeight" value="26"/>
        <property name="nValue" from="(def.objUnit.nHitPoints)"/>
        <property name="nValue2" from="(def.objUnit.objUnitTemplate.nHitPoints)"/>
        <property name="tmplImage" value="skin.ImgInfoIconHealthTny"/>
        <!--<property name="strToolTip" from="locale.SID.UI.HitPoints"/>-->
      </object>

      <object type="UI2DUnitStat" name="objElements">
				<property name="nY" value="0"/>
				<property name="nX" value="0"/>
				<property name="nHeight" value="26"/>
				<property name="nValue" from="def.objUnit.nExperience"/>
				<property name="tmplImage" value="skin.ImgInfoIconExperienceTny"/>
				<property name="strToolTip" from="
					locale.SID.UI.ExperienceLevel + ': ' + def.tmplUnitLevel.strDisplayName + '&#010;  ' +
					locale.SID.UI.CombatModifier + ': ' + find(?{mod: mod.eCombatProperty == gs_tbg.CombatProperty.COMBAT_PROPERTY_SEA_SURFACE},
						def.tmplUnitLevel.objCombatModifiers).nModifierValue + '%' + '&#010;  ' +
					locale.SID.UI.DamageModifier + ': ' + find(?{mod: mod.eCombatProperty == gs_tbg.CombatProperty.COMBAT_PROPERTY_ATTACK_DAMAGE},
						def.tmplUnitLevel.objCombatModifiers).nModifierValue"/>
			</object>

      <object type="UI2DUnitSpeed" name="objElements">
        <property name="nY" value="0"/>
        <property name="nX" value="0"/>
        <property name="nHeight" value="26"/>
        <property name="nValue">
            def.objUnit.objUnitTemplate.nSpeed
        </property>
        <property name="tmplImage" value="skin.ImgUnitIconSpeedTny"/>
        <property name="strToolTip" from="locale.SID.UI.UnitMovementRange"/>
      </object>

    </object>		
	
	</objectDef>

</locust>
